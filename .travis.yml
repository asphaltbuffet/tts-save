language: go

sudo: false

matrix:
  include:
    - go: master
    - go: 1.14.x
      env: LATEST=true
  allow_failures:
    - go: master

before_install:
  -go get github.com/mitchellh/gox

install:
  - # skip

before_script:
  - curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $GOPATH/bin v1.25.1
  - go mod vendor

script:
  #- go get -t -v ./...
  #- diff -u <(echo -n) <(gofmt -d .)
  #- go vet $(go list ./... | grep -v /vendor/)
  #- go test -v -race ./...

  - golangci-lint run       # run a bunch of code checkers/linters in parallel

  - if [ "${LATEST}" = "true"]; then gox -os="linux darwin windows" -arch="amd64" -output="logshare.." -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi
  
  deploy:
    provider: releases
    skip_cleanup: true
    api_key:
      # Your *encrypted* GitHub key, as the output of the Travis CI CLI tool.
      secure: "cQKjM/sXL7PML9QvISqWwJfNAO01lZC5AF4gNqN5thU8hn8RNmTEPz8i4wW33YouHgWjdQPpzec4pZMLfIjStvskQR0YapT7z6pFrQIWQpGvNwzXwqTBRlohIo539dLNVtSYUckYf40Zxce1l711aTXgnnHujX18JmgofOn2F7Zhbbf7HkdPTf2lHPcgs9nrV34OvqGCdEKOMBYXgAQRvZbxXqHSzzT/qXRFlfd9weRR7k9RVboJJIjSiF+r4CmhUyPwpbzN5Wfu1AgANq0KWsX1IWbPshBt8M3opOYqjlV+Sk0S6x8zRJTgjyP7xK6uYBFSKzE6gLkVHvYe3FcteCSAfgifimdvm2+SkHfs9GNpTzSahuhXT2Sb+auMQi3yMK/ev/slQ+m7WIQ5zOPh0mISbLgNhWLljIW8hsAxD1tdori+fdXm/5SS86vVItDII3A2C6zVlRgyrJAhhpvwsVhrFCpSajA8D971OSldA8uwK64Hz7O313a/arjhbCGeGiIksa5ogO7Pzeyvd/DzMUpSTZpwy7ZuElzHnvqwZ+pw/mcOabXZjdkY1QEEM/rkJJzXHaRiJ/NLIKG+uGmffncpJUc6W6c3aPhJ6T6MGpzMGZLbRembvdgklG1uh1RNB74YhhMKx5oNZ8h6gQ3RjzFu5SkHw/z8GzUzXbZ6HvE="
  file:
  # The names of the binaries to output, based on the -output template passed to gox.
  - logshare.windows.amd64.exe
  - logshare.darwin.amd64
  - logshare.linux.amd64
  on:
    # What to repository to build
    repo: asphaltbuffet/tts-save
    # Only build binaries for tagged commits
    tags: true
    condition: $LATEST = true

env:
  global:
    - GO111MODULE=on